You are creating the global Constitution for the **Cora Finance v2** app ‚Äî a personal finance platform built layer-by-layer with clean architecture, strong type safety, and a Liquid Glass MacOS Tahoe 2026-inspired design system.

This Constitution defines all **core laws** that every SpecKit feature, plan, and task will inherit.

---

## üåê Philosophy
Cora Finance follows a *layered incremental build*:
1. **Foundation & Master Data**
2. **Transactional Engine**
3. **Budgeting (YNAB methodology)**
4. **Portfolio Tracking**
5. **Analytics & Dashboard**
6. **AI Assistance (Text + Voice)**

Each layer builds upon previous foundations and adheres to the same design, architectural, and quality principles defined here.

---

## üèõÔ∏è Core Architectural Principles
- **Framework:** Next.js 15.5+ with App Router  
- **Language:** TypeScript (strict mode)  
- **ORM:** Drizzle ORM (PostgreSQL)  
- **API:** tRPC for type-safe client‚Äìserver communication  
- **UI Library:** shadcn/ui components customized to match the Liquid Glass design system  
- **Styling:** TailwindCSS 4.x  
- **State Management:** TanStack Query (React Query)  
- **Forms:** React Hook Form + Zod  
- **Testing:** Jest (unit), Playwright (E2E)  
- **Precision:** Decimal.js for all financial math  

### Folder Structure
/app
/components
/lib
/server
/hooks
/types
/drizzle (migrations)


### Naming
- Lowercase kebab-case for files.
- PascalCase for components and React hooks.
- All entities, schemas, and procedures must be explicitly typed.

---

## üíé Design System: ‚ÄúLiquid Glass‚Äù ‚Äî MacOS Tahoe 2026 Aesthetic
- Background: gradient from `#f5f7fa` to `#e9ecf5`.
- Surfaces: `bg-white/10` + `backdrop-blur-md` + `border border-white/20`.
- Depth: Use light diffusion, not shadows.
- Color Accents: Primary `#0EA5E9`, Secondary `#8B5CF6`.
- Typography: San Francisco / Inter variable font.
- Translucency and reflection mimic macOS control center panels.
- Motion: Subtle Framer Motion transitions (opacity 0.9‚Üí1, blur fade-in).
- Layout grid: 12-column responsive grid with consistent 16px gutters.

### Component Rules
- Cards, modals, and popovers: full glass treatment.
- Tables, forms, and data-heavy surfaces: semi-opaque for readability.
- Inputs: 5% glass transparency.
- Charts: optional glass frames.
- Dark mode optional (future phase).

---

## üß± Data Design Principles
- All financial values stored in integer cents.
- Dates stored in ISO 8601 (UTC).
- Soft deletes preferred (`archived` boolean).
- All foreign keys cascade on delete only when safe.
- Every table must include `created_at` and `updated_at`.

---

## ‚öôÔ∏è API & Validation Standards
- All endpoints use tRPC.
- Input validation with Zod.
- Business rules in server procedures (not client).
- Always return typed responses.
- No magic strings ‚Äî use enums and constants.

---

## üß© Testing Principles
- TDD encouraged for core logic.
- 80%+ code coverage for core modules.
- E2E for every major user workflow.
- Performance baseline: <500ms API response, <2s page load.
- Accessibility baseline: WCAG 2.1 AA.

---

## üåç Localization & Regional Rules
- Default locale: `pt-PT`.
- Default currency: EUR.
- Date format: DD/MM/YYYY.
- Thousands separator: period.
- Decimal separator: comma.
- First day of week: Monday.

---

## üîí Security & Compliance
- Use Drizzle parameterization for SQL safety.
- Validate all file uploads (PDFs only, max 10MB).
- XSS protection (React escaping).
- CSRF protection (Next.js middleware).
- HTTPS enforced in production.

---

## üìú Feature Spec Template (Inherited by All Phases)
Each feature spec must include the following sections:

Feature Name
Objective

Purpose and value to the user.

Scope

What‚Äôs included and excluded.

Data Model

Tables, fields, and relationships.

API Procedures

tRPC routers and endpoints.

UI Components

Layouts, components, and interactions.

Integration Points

Connections with previous layers.

Testing

Unit, integration, and E2E requirements.

Performance Targets

Load, query, and UX metrics.

Success Criteria

Definition of done.


---

## üìò Planning Template
Each plan.md generated by SpecKit must:
- Break the feature into sub-phases:
  1. Data Layer
  2. API Layer
  3. UI Layer
  4. Integration
  5. Testing & Polish
- Include estimated durations.
- Define dependencies (previous phase or schema).

---

## ‚úÖ Quality Gates
No phase is complete until:
- All tests pass.
- TypeScript build is clean.
- Accessibility audit passes.
- Performance within targets.
- Documentation updated.

---

**End of Constitution.**
